触发脚本说明
==============

触发方案概览
------------
- 目的：持续向链网注入“带标记”的恶意交易，既覆盖能正常进入交易池的泛洪型样本，也包含在验证阶段会被拒绝的样本，用于支撑 3.2.3.17~3.2.3.19 指标。
- 标记方式：所有恶意交易 `input` 字段前缀固定为 `0xdeaddead`（可在脚本参数中调整），以便观测脚本只依赖 `txpool.content` 即可识别。
- 交易组合：
  1. **传播型样本**（约 80%）：标准 `gasLimit` ≥ 21000、合理 `gasPrice`，确保进入交易池并向邻节点广播，用于衡量传播范围与路径。
  2. **拒绝型样本**（约 20%，比例可配置）：随机选择以下策略之一生成可验证失败的交易，便于观测“拒绝/错误反馈”指标：
     - 重复 nonce，`gasPrice` 不满足替换条件，触发 `replacement transaction underpriced`；
     - `value` 超过账户余额，触发 `insufficient funds for transfer`；
     - `gasLimit` 略低于 intrinsic（例如 20000），触发 `intrinsic gas too low`。
- 账户管理：脚本可使用本地解锁账户（`geth personal`）或环境变量提供的 keystore（`ATTACKER_KEYSTORE`），并在启动时打印攻击账户列表供观测脚本使用。

使用教程
--------
1. **准备工作**：
   - 确认攻击节点已生成至少一个可用账户并具备余额；
   - 若使用 keystore，提前通过 `export ATTACKER_KEYSTORE='{"address": ...}'` 设置环境变量；
   - 确认目标 RPC 或 IPC 地址可访问，且已启用 `txpool` 与 `personal` API（若需要解锁）。
2. **执行命令**（示例）：
   ```
   python3 malicious_trigger.py \
     --rpc http://202.118.8.10:8545 \
     --marker 0xdeaddead \
     --count 500 \
     --reject-ratio 0.2 \
     --interval 0.05 \
     --passphrase 123 \
     --target 0xd977e24382c435a70e09f1fa055614e0b838fc46
   ```
   - `--rpc / --ipc`：二选一，指定目标节点；
   - `--marker`：自定义数据前缀；
   - `--count`：总交易数；
   - `--reject-ratio`：拒绝型样本占比；
   - `--interval`：相邻交易之间的延迟（秒）；
   - `--passphrase`：解锁账户或 keystore 的口令。
3. **运行输出**：
   - 脚本在启动阶段打印攻击账户列表及建议在监测节点执行的 `export ATTACKER_ACCOUNTS=...`；
   - 对每笔交易输出时间戳、哈希、nonce、采用的策略（传播型或拒绝型），并记录 RPC 返回结果；
   - 结束时总结成功发送的数量、触发错误统计，便于核对观测脚本的样本数。

伪代码结构
-----------
```
读取命令行参数
建立 IPC 或 RPC 连接
加载攻击账户（本地解锁或解析 keystore），并打印账户列表

循环发送总共 N 笔交易：
    按拒绝占比随机选择本次交易类型（传播型或拒绝型）
    轮询选取发送账户，并选择目标账户（避免与 sender 相同）
    获取该账户当前 pending nonce 并结合本地已发送计数计算最终 nonce
    构造基础交易：设置 marker 前缀、预设 gasPrice、value、data

    如果是传播型：保持标准 gasLimit，确保交易能进入交易池
    如果是拒绝型：
        随机选择策略之一：降低 gasLimit、重复 nonce 降价、增加 value 使余额不足
        根据策略调整交易字段

    发送交易：
        若使用 keystore，先离线签名再调用 send_raw_transaction
        否则直接调用 send_transaction
    捕获 RPC 返回；成功则记录哈希、nonce 与模式，失败则记录错误信息

    递增本地发送计数，休眠 interval 秒后进入下一轮
```
- “拒绝型”策略需要均匀分布，以便观测脚本获得多种错误类型；
- 日志中建议保留时间戳、交易哈希、选择的模式及 RPC 返回，便于后续与观测数据对账。

注意事项
--------
- 避免长时间重复使用同一 nonce 导致本地计数与节点真实状态偏差，可在每轮循环前刷新 `pending` nonce；
- 若目标节点未开启 `personal` API，务必使用 keystore 签名模式；
- 建议在正式实验前先执行小批量验证，确认拒绝型交易确实产生预期错误消息。